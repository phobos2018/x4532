"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@angular/core");
const sidedrawer_1 = require("nativescript-pro-ui/sidedrawer");
const angular_1 = require("nativescript-pro-ui/sidedrawer/angular");
const page_1 = require("ui/page");
const router_1 = require("@angular/router");
const dialogs_1 = require("nativescript-angular/directives/dialogs");
const market_confirmation_modal_1 = require("./market-confirmation-modal/market-confirmation-modal");
require("rxjs/add/observable/combineLatest");
const shared_1 = require("../shared");
const webViewInterfaceModule = require('nativescript-webview-interface');
let MarketComponent = class MarketComponent {
    constructor(router, activatedRoute, pooling, core, watchService, exchange, modal, vcRef, page) {
        this.router = router;
        this.activatedRoute = activatedRoute;
        this.pooling = pooling;
        this.core = core;
        this.watchService = watchService;
        this.exchange = exchange;
        this.modal = modal;
        this.vcRef = vcRef;
        this.page = page;
        this.isOpen = 0;
        this.isBuySelected = true;
        this.balances = {};
        //
    }
    ngOnInit() {
        const iqKeyboard = IQKeyboardManager.sharedManager();
        iqKeyboard.overrideKeyboardAppearance = true;
        iqKeyboard.keyboardAppearance = 1 /* Dark */;
        this._sideDrawerTransition = new sidedrawer_1.SlideInOnTopTransition();
        this.activatedRoute.params.subscribe((params) => {
            // Todo: implement other pairs
            // core
            // this.marketName = "BTC-" + params['MarketName'];
            this.marketName = params['MarketName'] + "/BTC";
            this.page.on('navigatingTo', (data) => {
                this.marektSubscription = this.watchService.getMarket(this.marketName)
                    .subscribe((market) => {
                    this.market = market;
                    this.mapMarket(market);
                });
                this.watchService.getBalances();
            });
            this.page.on('navigatingFrom', (data) => {
                this.marektSubscription.unsubscribe();
            });
        });
    }
    ngAfterViewInit() {
        //
    }
    populatePrice() {
        // core
        // this.rate = this.market.Bid;
        this.rate = this.market.bid;
    }
    populatePriceAsk() {
        this.rateSell = this.market.Ask;
    }
    // Process / proceed ..
    proceedTransaction() {
        if (!this.quantity || !this.quantitySell) {
            alert("Quantity field cannot be empty");
            return false;
        }
        if (!this.rate || !this.rateSell) {
            alert("Price field cannot be empty");
            return false;
        }
        this.market.type = this.isBuySelected ? 'BUY' : 'SELL';
        this.market.typeString = this.isBuySelected ? 'Limit Buy' : 'Limit Sell';
        this.market.rate = this.isBuySelected ? this.rate : this.rateSell;
        this.market.quantity = this.isBuySelected ? this.quantity : this.quantitySell;
        this.showConfirmationModal();
    }
    onDrawerButtonTap() {
        this.drawerComponent.sideDrawer.showDrawer();
    }
    showConfirmationModal() {
        const options = {
            context: { market: this.market },
            fullscreen: true,
            viewContainerRef: this.vcRef
        };
        this.modal.showModal(market_confirmation_modal_1.MarketConfirmationModalComponent, options).then((res) => {
            // Callback currently does nothing
        });
    }
    selectMainTab(tabId) {
        this.isOpen = tabId;
    }
    selectBuySellTab(buySelected) {
        this.isBuySelected = buySelected;
    }
    onChange($event) {
        // ngModel check simple validator check
    }
    get isBuyTabActive() {
        return this.isBuySelected;
    }
    isActive(tabId) {
        return this.isOpen === tabId;
    }
    calculateSpread() {
        // core
        // this.spread = this.exchange.calculateSpread(this.market.Bid, this.market.Ask);
        this.spread = this.exchange.calculateSpread(this.market.bid, this.market.ask);
    }
    comparePreviousPrice() {
        this.lastPriceOffset = !!(this.marketPrev.last - 0);
        // core
        // this.lastPriceOffset = !!(this.marketPrev.Last - this.market.Last);
    }
    mapMarket(market) {
        this.marketPrev = Object.assign({}, market);
        this.market.BaseVolume = this.market.baseVolume.toString().split(".")[0];
        this.comparePreviousPrice();
        this.market.Last = this.watchService.parseExponential(market.last);
        this.market.Low = this.watchService.parseExponential(market.low);
        this.market.High = this.watchService.parseExponential(market.high);
        this.market.Bid = this.watchService.parseExponential(market.bid);
        this.market.Ask = this.watchService.parseExponential(market.ask);
        this.market.Pair = market.symbol.split("/")[1];
        this.ticker = market.symbol.split("/")[0];
        this.market.MarketName = this.ticker;
        if (this.watchService.balances) {
            if (this.watchService.balances.hasOwnProperty(this.ticker)) {
                this.marketBalance = this.watchService.balances[this.ticker].Balance.toFixed(2);
                if (this.watchService.balances[this.ticker].Balance !==
                    this.watchService.balances[this.ticker].Available) {
                    this.marketBalanceAvailable = this.watchService.balances[this.ticker].Available.toFixed(2);
                }
            }
        }
        this.calculateSpread();
    }
    // Todo: getMax doesn't work well, needs work
    getMax() {
        const fee = 0.001;
        if (!this.rate) {
            this.quantity = 0;
        }
        else {
            // Todo check balance ~ available balance diff in some cases
            this.quantity = +(this.watchService.balances['BTC'].Balance / (this.rate - this.rate * fee)).toFixed(2);
        }
    }
    get sideDrawerTransition() {
        return this._sideDrawerTransition;
    }
    cancelOrder(index) {
        const id = this.watchService.getuuid(index);
        this.watchService.showPoolingModal('Cancelation ', 'Canceling..');
        this.core.cancelOrder(id, this.watchService)
            .subscribe((response) => {
            this.watchService.removeOrderFromMap(id);
            this.watchService.showPoolingModal('The order has been canceled', 'Cancelation ');
        });
    }
};
__decorate([
    core_1.ViewChild("drawer"),
    __metadata("design:type", angular_1.RadSideDrawerComponent)
], MarketComponent.prototype, "drawerComponent", void 0);
MarketComponent = __decorate([
    core_1.Component({
        selector: "Market",
        moduleId: module.id,
        templateUrl: "./market.component.html"
    }),
    __metadata("design:paramtypes", [router_1.Router,
        router_1.ActivatedRoute,
        shared_1.PoolingService,
        shared_1.CoreExchange,
        shared_1.WatchService,
        shared_1.ExchangeService,
        dialogs_1.ModalDialogService,
        core_1.ViewContainerRef,
        page_1.Page])
], MarketComponent);
exports.MarketComponent = MarketComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFya2V0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1hcmtldC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx3Q0FDdUY7QUFDdkYsK0RBQThGO0FBQzlGLG9FQUFnRjtBQUNoRixrQ0FBK0I7QUFDL0IsNENBQXlEO0FBRXpELHFFQUE2RTtBQUM3RSxxR0FBeUc7QUFHekcsNkNBQTJDO0FBRTNDLHNDQUF3RjtBQUd4RixNQUFNLHNCQUFzQixHQUFHLE9BQU8sQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBUXpFLElBQWEsZUFBZSxHQUE1QjtJQTJCSSxZQUNZLE1BQWMsRUFDZCxjQUE4QixFQUM5QixPQUF1QixFQUN2QixJQUFrQixFQUNsQixZQUEwQixFQUMxQixRQUF5QixFQUN6QixLQUF5QixFQUN6QixLQUF1QixFQUN2QixJQUFVO1FBUlYsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixZQUFPLEdBQVAsT0FBTyxDQUFnQjtRQUN2QixTQUFJLEdBQUosSUFBSSxDQUFjO1FBQ2xCLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQzFCLGFBQVEsR0FBUixRQUFRLENBQWlCO1FBQ3pCLFVBQUssR0FBTCxLQUFLLENBQW9CO1FBQ3pCLFVBQUssR0FBTCxLQUFLLENBQWtCO1FBQ3ZCLFNBQUksR0FBSixJQUFJLENBQU07UUE1QmQsV0FBTSxHQUFXLENBQUMsQ0FBQztRQUNuQixrQkFBYSxHQUFZLElBQUksQ0FBQztRQUs5QixhQUFRLEdBQUcsRUFBRSxDQUFDO1FBd0JsQixFQUFFO0lBQ04sQ0FBQztJQUVELFFBQVE7UUFFSixNQUFNLFVBQVUsR0FBRyxpQkFBaUIsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyRCxVQUFVLENBQUMsMEJBQTBCLEdBQUcsSUFBSSxDQUFDO1FBQzdDLFVBQVUsQ0FBQyxrQkFBa0IsZUFBNEIsQ0FBQztRQUUxRCxJQUFJLENBQUMs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QUNwQixNQUFNLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDO0lBQ3RDLENBQUM7SUFFTyxXQUFXLENBQUMsS0FBSztRQUNyQixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUU1QyxJQUFJLENBQUMsWUFBWSxDQUFDLGdCQUFnQixDQUFDLGNBQWMsRUFBRSxhQUFhLENBQUMsQ0FBQztRQUNsRSxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQzthQUN2QyxTQUFTLENBQUMsQ0FBQyxRQUFRO1lBQ2hCLElBQUksQ0FBQyxZQUFZLENBQUMsa0JBQWtCLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDekMsSUFBSSxDQUFDLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyw2QkFBNkIsRUFBRSxjQUFjLENBQUMsQ0FBQztRQUN0RixDQUFDLENBQUMsQ0FBQztJQUNYLENBQUM7Q0FDSixDQUFBO0FBOU13QjtJQUFwQixnQkFBUyxDQUFDLFFBQVEsQ0FBQzs4QkFBa0IsZ0NBQXNCO3dEQUFDO0FBRnBELGVBQWU7SUFOM0IsZ0JBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSxRQUFRO1FBQ2xCLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtRQUNuQixXQUFXLEVBQUUseUJBQXlCO0tBQ3pDLENBQUM7cUNBOEJzQixlQUFNO1FBQ0UsdUJBQWM7UUFDckIsdUJBQWM7UUFDakIscUJBQVk7UUFDSixxQkFBWTtRQUNoQix3QkFBZTtRQUNsQiw0QkFBa0I7UUFDbEIsdUJBQWdCO1FBQ2pCLFdBQUk7R0FwQ2IsZUFBZSxDQWdOM0I7QUFoTlksMENBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkLCBWaWV3Q29udGFpbmVyUmVmLFxuICAgICAgICBFbGVtZW50UmVmLCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3ksIENoYW5nZURldGVjdG9yUmVmIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IERyYXdlclRyYW5zaXRpb25CYXNlLCBTbGlkZUluT25Ub3BUcmFuc2l0aW9uIH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1wcm8tdWkvc2lkZWRyYXdlclwiO1xuaW1wb3J0IHsgUmFkU2lkZURyYXdlckNvbXBvbmVudCB9IGZyb20gXCJuYXRpdmVzY3JpcHQtcHJvLXVpL3NpZGVkcmF3ZXIvYW5ndWxhclwiO1xuaW1wb3J0IHsgUGFnZSB9IGZyb20gJ3VpL3BhZ2UnO1xuaW1wb3J0IHsgUm91dGVyLCBBY3RpdmF0ZWRSb3V0ZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5cbmltcG9ydCB7IE1vZGFsRGlhbG9nU2VydmljZSB9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhci9kaXJlY3RpdmVzL2RpYWxvZ3NcIjtcbmltcG9ydCB7IE1hcmtldENvbmZpcm1hdGlvbk1vZGFsQ29tcG9uZW50IH0gZnJvbSBcIi4vbWFya2V0LWNvbmZpcm1hdGlvbi1tb2RhbC9tYXJrZXQtY29uZmlybWF0aW9uLW1vZGFsXCI7XG5cbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzL1J4JztcbmltcG9ydCAncnhqcy9hZGQvb2JzZXJ2YWJsZS9jb21iaW5lTGF0ZXN0JztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMvU3Vic2NyaXB0aW9uJztcbmltcG9ydCB7IEV4Y2hhbmdlU2VydmljZSwgV2F0Y2hTZXJ2aWNlLCBDb3JlRXhjaGFuZ2UsIFBvb2xpbmdTZXJ2aWNlIH0gZnJvbSBcIi4uL3NoYXJlZFwiO1xuXG5pbXBvcnQgeyBXZWJWaWV3LCBMb2FkRXZlbnREYXRhIH0gZnJvbSAndWkvd2ViLXZpZXcnO1xuY29uc3Qgd2ViVmlld0ludGVyZmFjZU1vZHVsZSA9IHJlcXVpcmUoJ25hdGl2ZXNjcmlwdC13ZWJ2aWV3LWludGVyZmFjZScpO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogXCJNYXJrZXRcIixcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgIHRlbXBsYXRlVXJsOiBcIi4vbWFya2V0LmNvbXBvbmVudC5odG1sXCJcbn0pXG5cbmV4cG9ydCBjbGFzcyBNYXJrZXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQge1xuXG4gICAgQFZpZXdDaGlsZChcImRyYXdlclwiKSBkcmF3ZXJDb21wb25lbnQ6IFJhZFNpZGVEcmF3ZXJDb21wb25lbnQ7XG5cbiAgICAvLyBUb2RvOiB1bnN1YnNjcmliZVxuICAgIHByaXZhdGUgbWFya2V0U3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gICAgcHJpdmF0ZSBiYWxhbmNlc09ic2VydmFibGU6IE9ic2VydmFibGU8YW55PjtcbiAgICBwcml2YXRlIF9zaWRlRHJhd2VyVHJhbnNpdGlvbjogRHJhd2VyVHJhbnNpdGlvbkJhc2U7XG4gICAgcHJpdmF0ZSBpc09wZW46IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBpc0J1eVNlbGVjdGVkOiBib29sZWFuID0gdHJ1ZTtcbiAgICBwcml2YXRlIG1hcmtldDtcbiAgICBwcml2YXRlIG1hcmtldFByZXY7XG4gICAgcHJpdmF0ZSBsYXN0UHJpY2VPZmZzZXQ7XG4gICAgcHJpdmF0ZSBzcHJlYWQ6IHN0cmluZztcbiAgICBwcml2YXRlIGJhbGFuY2VzID0ge307XG4gICAgcHJpdmF0ZSBwcmljZUJ1eTtcbiAgICBwcml2YXRlIG1hcmtldE5hbWU6IHN0cmluZztcbiAgICBwcml2YXRlIHF1YW50aXR5OiBudW1iZXI7XG4gICAgcHJpdmF0ZSBxdWFudGl0eVNlbGw6IG51bWJlcjtcbiAgICBwcml2YXRlIHJhdGU6IG51bWJlcjtcbiAgICBwcml2YXRlIHJhdGVTZWxsOiBudW1iZXI7XG4gICAgcHJpdmF0ZSB0aWNrZXI6IHN0cmluZztcbiAgICBwcml2YXRlIG1hcmtldEJhbGFuY2U7XG4gICAgcHJpdmF0ZSBtYXJrZXRCYWxhbmNlQXZhaWxhYmxlO1xuICAgIHByaXZhdGUgbWFyZWt0U3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gICAgcHJpdmF0ZSBiYWxhbmNlU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICAgICAgcHJpdmF0ZSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICAgICAgIHByaXZhdGUgcG9vbGluZzogUG9vbGluZ1NlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgY29yZTogQ29yZUV4Y2hhbmdlLFxuICAgICAgICBwcml2YXRlIHdhdGNoU2VydmljZTogV2F0Y2hTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGV4Y2hhbmdlOiBFeGNoYW5nZVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgbW9kYWw6IE1vZGFsRGlhbG9nU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSB2Y1JlZjogVmlld0NvbnRhaW5lclJlZixcbiAgICAgICAgcHJpdmF0ZSBwYWdlOiBQYWdlXG4gICAgKSB7XG4gICAgICAgIC8vXG4gICAgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG5cbiAgICAgICAgY29uc3QgaXFLZXlib2FyZCA9IElRS2V5Ym9hcmRNYW5hZ2VyLnNoYXJlZE1hbmFnZXIoKTtcbiAgICAgICAgaXFLZXlib2FyZC5vdmVycmlkZUtleWJvYXJkQXBwZWFyYW5jZSA9IHRydWU7XG4gICAgICAgIGlxS2V5Ym9hcmQua2V5Ym9hcmRBcHBlYXJhbmNlID0gVUlLZXlib2FyZEFwcGVhcmFuY2UuRGFyaztcblxuICAgICAgICB0aGlzLl9zaWRlRHJhd2VyVHJhbnNpdGlvbiA9IG5ldyBTbGlkZUluT25Ub3BUcmFuc2l0aW9uKCk7XG5cbiAgICAgICAgdGhpcy5hY3RpdmF0ZWRSb3V0ZS5wYXJhbXMuc3Vic2NyaWJlKChwYXJhbXMpID0+IHtcblxuICAgICAgICAgICAgLy8gVG9kbzogaW1wbGVtZW50IG90aGVyIHBhaXJzXG4gICAgICAgICAgICAvLyBjb3JlXG4gICAgICAgICAgICAvLyB0aGlzLm1hcmtldE5hbWUgPSBcIkJUQy1cIiArIHBhcmFtc1snTWFya2V0TmFtZSddO1xuICAgICAgICAgICAgdGhpcy5tYXJrZXROYW1lID0gcGFyYW1zWydNYXJrZXROYW1lJ10gKyBcIi9CVENcIjtcblxuICAgICAgICAgICAgdGhpcy5wYWdlLm9uKCduYXZpZ2F0aW5nVG8nLCAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubWFyZWt0U3Vic2NyaXB0aW9uID0gdGhpcy53YXRjaFNlcnZpY2UuZ2V0TWFya2V0KHRoaXMubWFya2V0TmFtZSlcbiAgICAgICAgICAgICAgICAgICAgLnN1YnNjcmliZSgobWFya2V0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcmtldCA9IG1hcmtldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWFwTWFya2V0KG1hcmtldCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMud2F0Y2hTZXJ2aWNlLmdldEJhbGFuY2VzKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5wYWdlLm9uKCduYXZpZ2F0aW5nRnJvbScsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5tYXJla3RTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgICAgIC8vXG4gICAgfVxuXG4gICAgcG9wdWxhdGVQcmljZSgpIHtcbiAgICAgICAgLy8gY29yZVxuICAgICAgICAvLyB0aGlzLnJhdGUgPSB0aGlzLm1hcmtldC5CaWQ7XG4gICAgICAgIHRoaXMucmF0ZSA9IHRoaXMubWFya2V0LmJpZDtcbiAgICB9XG5cbiAgICBwb3B1bGF0ZVByaWNlQXNrKCkge1xuICAgICAgICB0aGlzLnJhdGVTZWxsID0gdGhpcy5tYXJrZXQuQXNrO1xuICAgIH1cblxuICAgIC8vIFByb2Nlc3MgLyBwcm9jZWVkIC4uXG4gICAgcHJvY2VlZFRyYW5zYWN0aW9uKCkge1xuXG4gICAgICAgIGlmICghdGhpcy5xdWFudGl0eSB8fCAhdGhpcy5xdWFudGl0eVNlbGwpIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiUXVhbnRpdHkgZmllbGQgY2Fubm90IGJlIGVtcHR5XCIpO1xuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnJhdGUgfHwgIXRoaXMucmF0ZVNlbGwpIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiUHJpY2UgZmllbGQgY2Fubm90IGJlIGVtcHR5XCIpO1xuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1hcmtldC50eXBlID0gdGhpcy5pc0J1eVNlbGVjdGVkID8gJ0JVWScgOiAnU0VMTCc7XG4gICAgICAgIHRoaXMubWFya2V0LnR5cGVTdHJpbmcgPSB0aGlzLmlzQnV5U2VsZWN0ZWQgPyAnTGltaXQgQnV5JyA6ICdMaW1pdCBTZWxsJztcbiAgICAgICAgdGhpcy5tYXJrZXQucmF0ZSA9IHRoaXMuaXNCdXlTZWxlY3RlZCA/IHRoaXMucmF0ZSA6IHRoaXMucmF0ZVNlbGw7XG4gICAgICAgIHRoaXMubWFya2V0LnF1YW50aXR5ID0gdGhpcy5pc0J1eVNlbGVjdGVkID8gdGhpcy5xdWFudGl0eSA6IHRoaXMucXVhbnRpdHlTZWxsO1xuICAgICAgICB0aGlzLnNob3dDb25maXJtYXRpb25Nb2RhbCgpO1xuICAgIH1cblxuICAgIG9uRHJhd2VyQnV0dG9uVGFwKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmRyYXdlckNvbXBvbmVudC5zaWRlRHJhd2VyLnNob3dEcmF3ZXIoKTtcbiAgICB9XG5cbiAgICBzaG93Q29uZmlybWF0aW9uTW9kYWwoKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBjb250ZXh0OiB7bWFya2V0OiB0aGlzLm1hcmtldH0sXG4gICAgICAgICAgICBmdWxsc2NyZWVuOiB0cnVlLFxuICAgICAgICAgICAgdmlld0NvbnRhaW5lclJlZjogdGhpcy52Y1JlZlxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm1vZGFsLnNob3dNb2RhbChNYXJrZXRDb25maXJtYXRpb25Nb2RhbENvbXBvbmVudCwgb3B0aW9ucykudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICAvLyBDYWxsYmFjayBjdXJyZW50bHkgZG9lcyBub3RoaW5nXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2VsZWN0TWFpblRhYih0YWJJZCkge1xuICAgICAgICB0aGlzLmlzT3BlbiA9IHRhYklkO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2VsZWN0QnV5U2VsbFRhYihidXlTZWxlY3RlZCkge1xuICAgICAgICB0aGlzLmlzQnV5U2VsZWN0ZWQgPSBidXlTZWxlY3RlZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uQ2hhbmdlKCRldmVudCkge1xuICAgICAgICAvLyBuZ01vZGVsIGNoZWNrIHNpbXBsZSB2YWxpZGF0b3IgY2hlY2tcbiAgICB9XG5cbiAgICBnZXQgaXNCdXlUYWJBY3RpdmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzQnV5U2VsZWN0ZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0FjdGl2ZSh0YWJJZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pc09wZW4gPT09IHRhYklkO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2FsY3VsYXRlU3ByZWFkKCkge1xuICAgICAgICAvLyBjb3JlXG4gICAgICAgIC8vIHRoaXMuc3ByZWFkID0gdGhpcy5leGNoYW5nZS5jYWxjdWxhdGVTcHJlYWQodGhpcy5tYXJrZXQuQmlkLCB0aGlzLm1hcmtldC5Bc2spO1xuICAgICAgICB0aGlzLnNwcmVhZCA9IHRoaXMuZXhjaGFuZ2UuY2FsY3VsYXRlU3ByZWFkKHRoaXMubWFya2V0LmJpZCwgdGhpcy5tYXJrZXQuYXNrKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNvbXBhcmVQcmV2aW91c1ByaWNlKCkge1xuICAgICAgICB0aGlzLmxhc3RQcmljZU9mZnNldCA9ICEhKHRoaXMubWFya2V0UHJldi5sYXN0IC0gMCk7XG4gICAgICAgIC8vIGNvcmVcbiAgICAgICAgLy8gdGhpcy5sYXN0UHJpY2VPZmZzZXQgPSAhISh0aGlzLm1hcmtldFByZXYuTGFzdCAtIHRoaXMubWFya2V0Lkxhc3QpO1xuICAgIH1cblxuICAgIHByaXZhdGUgbWFwTWFya2V0KG1hcmtldCkge1xuXG4gICAgICAgIHRoaXMubWFya2V0UHJldiA9IHsuLi5tYXJrZXR9O1xuICAgICAgICB0aGlzLm1hcmtldC5CYXNlVm9sdW1lID0gdGhpcy5tYXJrZXQuYmFzZVZvbHVtZS50b1N0cmluZygpLnNwbGl0KFwiLlwiKVswXTtcblxuICAgICAgICB0aGlzLmNvbXBhcmVQcmV2aW91c1ByaWNlKCk7XG5cbiAgICAgICAgdGhpcy5tYXJrZXQuTGFzdCA9IHRoaXMud2F0Y2hTZXJ2aWNlLnBhcnNlRXhwb25lbnRpYWwobWFya2V0Lmxhc3QpO1xuICAgICAgICB0aGlzLm1hcmtldC5Mb3cgPSB0aGlzLndhdGNoU2VydmljZS5wYXJzZUV4cG9uZW50aWFsKG1hcmtldC5sb3cpO1xuICAgICAgICB0aGlzLm1hcmtldC5IaWdoID0gdGhpcy53YXRjaFNlcnZpY2UucGFyc2VFeHBvbmVudGlhbChtYXJrZXQuaGlnaCk7XG4gICAgICAgIHRoaXMubWFya2V0LkJpZCA9IHRoaXMud2F0Y2hTZXJ2aWNlLnBhcnNlRXhwb25lbnRpYWwobWFya2V0LmJpZCk7XG4gICAgICAgIHRoaXMubWFya2V0LkFzayA9IHRoaXMud2F0Y2hTZXJ2aWNlLnBhcnNlRXhwb25lbnRpYWwobWFya2V0LmFzayk7XG4gICAgICAgIHRoaXMubWFya2V0LlBhaXIgPSBtYXJrZXQuc3ltYm9sLnNwbGl0KFwiL1wiKVsxXTtcbiAgICAgICAgdGhpcy50aWNrZXIgPSBtYXJrZXQuc3ltYm9sLnNwbGl0KFwiL1wiKVswXTtcbiAgICAgICAgdGhpcy5tYXJrZXQuTWFya2V0TmFtZSA9IHRoaXMudGlja2VyO1xuXG4gICAgICAgIGlmICh0aGlzLndhdGNoU2VydmljZS5iYWxhbmNlcykge1xuICAgICAgICAgICAgaWYgKHRoaXMud2F0Y2hTZXJ2aWNlLmJhbGFuY2VzLmhhc093blByb3BlcnR5KHRoaXMudGlja2VyKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubWFya2V0QmFsYW5jZSA9IHRoaXMud2F0Y2hTZXJ2aWNlLmJhbGFuY2VzW3RoaXMudGlja2VyXS5CYWxhbmNlLnRvRml4ZWQoMik7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMud2F0Y2hTZXJ2aWNlLmJhbGFuY2VzW3RoaXMudGlja2VyXS5CYWxhbmNlICE9PVxuICAgICAgICAgICAgICAgICAgICB0aGlzLndhdGNoU2VydmljZS5iYWxhbmNlc1t0aGlzLnRpY2tlcl0uQXZhaWxhYmxlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXJrZXRCYWxhbmNlQXZhaWxhYmxlID0gdGhpcy53YXRjaFNlcnZpY2UuYmFsYW5jZXNbdGhpcy50aWNrZXJdLkF2YWlsYWJsZS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhbGN1bGF0ZVNwcmVhZCgpO1xuICAgIH1cblxuICAgIC8vIFRvZG86IGdldE1heCBkb2Vzbid0IHdvcmsgd2VsbCwgbmVlZHMgd29ya1xuICAgIHByaXZhdGUgZ2V0TWF4KCkge1xuICAgICAgICBjb25zdCBmZWUgPSAwLjAwMTtcbiAgICAgICAgaWYgKCF0aGlzLnJhdGUpIHtcbiAgICAgICAgICAgIHRoaXMucXVhbnRpdHkgPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gVG9kbyBjaGVjayBiYWxhbmNlIH4gYXZhaWxhYmxlIGJhbGFuY2UgZGlmZiBpbiBzb21lIGNhc2VzXG4gICAgICAgICAgICB0aGlzLnF1YW50aXR5ID0gKyh0aGlzLndhdGNoU2VydmljZS5iYWxhbmNlc1snQlRDJ10uQmFsYW5jZSAvICh0aGlzLnJhdGUgLSB0aGlzLnJhdGUgKiBmZWUpKS50b0ZpeGVkKDIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IHNpZGVEcmF3ZXJUcmFuc2l0aW9uKCk6IERyYXdlclRyYW5zaXRpb25CYXNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NpZGVEcmF3ZXJUcmFuc2l0aW9uO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2FuY2VsT3JkZXIoaW5kZXgpIHtcbiAgICAgICAgY29uc3QgaWQgPSB0aGlzLndhdGNoU2VydmljZS5nZXR1dWlkKGluZGV4KTtcblxuICAgICAgICB0aGlzLndhdGNoU2VydmljZS5zaG93UG9vbGluZ01vZGFsKCdDYW5jZWxhdGlvbiAnLCAnQ2FuY2VsaW5nLi4nKTtcbiAgICAgICAgdGhpcy5jb3JlLmNhbmNlbE9yZGVyKGlkLCB0aGlzLndhdGNoU2VydmljZSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy53YXRjaFNlcnZpY2UucmVtb3ZlT3JkZXJGcm9tTWFwKGlkKTtcbiAgICAgICAgICAgICAgICB0aGlzLndhdGNoU2VydmljZS5zaG93UG9vbGluZ01vZGFsKCdUaGUgb3JkZXIgaGFzIGJlZW4gY2FuY2VsZWQnLCAnQ2FuY2VsYXRpb24gJyk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG59XG4iXX0=